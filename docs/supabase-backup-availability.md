# Supabaseバックアップと可用性の設定

このドキュメントでは、Supabaseプロジェクトのバックアップと可用性の設定方法について説明します。

## 1. バックアップの設定

### 1.1 定期的なバックアップの設定

Supabaseダッシュボードで以下の手順を実行します：

1. プロジェクトダッシュボードにログイン
2. 左側のメニューから「Project Settings」を選択
3. 「Database」タブを選択
4. 「Backups」セクションで設定を行う
   - 「Point in Time Recovery (PITR)」を有効化（有料プランが必要）
   - バックアップの保持期間を設定（推奨：7日間以上）

### 1.2 手動バックアップの実行

緊急時や重要な変更前には手動バックアップを実行することをお勧めします：

1. プロジェクトダッシュボードの「Project Settings」→「Database」→「Backups」
2. 「Create Backup」ボタンをクリック
3. バックアップ名を入力して作成

## 2. パフォーマンス設定の最適化

### 2.1 データベースリソースの設定

1. プロジェクトダッシュボードの「Project Settings」→「Database」
2. 「Configuration」セクションでリソース設定を確認
   - 必要に応じてコンピュートサイズをアップグレード
   - メモリ使用量を監視し、必要に応じて調整

### 2.2 インデックスの作成

頻繁に検索されるフィールドにはインデックスを作成します：

```sql
-- 記事タイトルの検索を高速化するインデックス
CREATE INDEX idx_articles_title ON public.articles (title);

-- 記事ステータスでの検索を高速化するインデックス
CREATE INDEX idx_articles_status ON public.articles (status);

-- 著者IDでの検索を高速化するインデックス
CREATE INDEX idx_articles_author_id ON public.articles (author_id);
```

## 3. 監視アラートの設定

### 3.1 パフォーマンス監視

1. プロジェクトダッシュボードの「Project Settings」→「Database」→「Monitoring」
2. CPU使用率、メモリ使用率、ディスク使用率などの指標を監視
3. 異常値に対するアラートを設定

### 3.2 エラー監視

1. プロジェクトダッシュボードの「Logs」セクション
2. エラーログを定期的に確認
3. 重要なエラーに対するアラートを設定

## 4. 障害復旧計画

### 4.1 バックアップからの復元手順

1. プロジェクトダッシュボードの「Project Settings」→「Database」→「Backups」
2. 復元したいバックアップを選択
3. 「Restore」ボタンをクリック
4. 復元先のプロジェクトを選択（新規または既存）

### 4.2 障害発生時の対応手順

1. 問題の特定と記録
2. Supabaseステータスページ（https://status.supabase.com/）で障害情報を確認
3. 必要に応じてバックアップから復元
4. アプリケーションの動作確認
5. ユーザーへの通知

## 5. 定期的なメンテナンス

### 5.1 データベースの最適化

1. 不要なデータの削除または圧縮
2. テーブルの最適化（VACUUM）
3. インデックスの再構築

### 5.2 セキュリティ設定の確認

1. RLSポリシーの定期的な見直し
2. APIキーのローテーション
3. アクセスログの確認

これらの設定と手順を実施することで、データの安全性と可用性を確保し、障害発生時にも迅速に対応できる体制を整えることができます。 